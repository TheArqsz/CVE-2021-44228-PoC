#!/bin/bash
set -e

if [ -z "$1" ]; then
    echo "No app folder specified"
    exit 1
fi

CURR_PATH=`pwd`

APP_FOLDER=$1

# Build vuln app
cd "$APP_FOLDER"
sudo rm -rf target/*
docker build -f Dockerfile-build -t mvnbuild --no-cache .
docker run --rm -it -v $(pwd)/target:/vulnapp/target mvnbuild
sudo rm -rf target/archive-tmp target/classes target/generated-sources target/maven-status
mv target/vulnapp-1.0-jar-with-dependencies.jar target/vulnapp.jar
docker image rm mvnbuild
cd "$CURR_PATH"